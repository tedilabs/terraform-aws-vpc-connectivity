# lattice-service

This module creates following resources.

- `aws_vpclattice_service`
- `aws_vpclattice_auth_policy` (optional)
- `aws_vpclattice_resource_policy` (optional)
- `aws_vpclattice_listener` (optional)
- `aws_vpclattice_listener_rule` (optional)
- `aws_vpclattice_service_network_service_association` (optional)
- `aws_vpclattice_access_log_subscription` (optional)

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 1.5 |
| <a name="requirement_aws"></a> [aws](#requirement\_aws) | >= 5.21 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_aws"></a> [aws](#provider\_aws) | 5.22.0 |

## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_listener"></a> [listener](#module\_listener) | ../lattice-service-listener | n/a |
| <a name="module_resource_group"></a> [resource\_group](#module\_resource\_group) | tedilabs/misc/aws//modules/resource-group | ~> 0.10.0 |
| <a name="module_share"></a> [share](#module\_share) | tedilabs/account/aws//modules/ram-share | ~> 0.27.0 |

## Resources

| Name | Type |
|------|------|
| [aws_vpclattice_access_log_subscription.cloudwatch](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpclattice_access_log_subscription) | resource |
| [aws_vpclattice_access_log_subscription.kinesis_data_firehose](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpclattice_access_log_subscription) | resource |
| [aws_vpclattice_access_log_subscription.s3](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpclattice_access_log_subscription) | resource |
| [aws_vpclattice_auth_policy.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpclattice_auth_policy) | resource |
| [aws_vpclattice_resource_policy.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpclattice_resource_policy) | resource |
| [aws_vpclattice_service.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpclattice_service) | resource |
| [aws_vpclattice_service_network_service_association.this](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/vpclattice_service_network_service_association) | resource |

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_name"></a> [name](#input\_name) | (Required) The name of the service. The name must be unique within the account. The valid characters are a-z, 0-9, and hyphens (-). You can't use a hyphen as the first or last character, or immediately after another hyphen. This name will become part of the service DNS and can't be changed after the VPC Lattice service is created. | `string` | n/a | yes |
| <a name="input_auth_policy"></a> [auth\_policy](#input\_auth\_policy) | (Optional) The auth policy. Authorization decisions are made based on the service network policy, this policy, and IAM permissions attached to the client identity (if referencing IAM identities in this policy). The policy string in JSON must not contain newlines or blank lines. | `string` | `null` | no |
| <a name="input_auth_type"></a> [auth\_type](#input\_auth\_type) | (Optional) The type of authentication and authorization that manages client access to the service. Valid values are `AWS_IAM` or `NONE`. Defaults to `NONE`.<br>    `NONE` - Authentication and authorization is turned off at the service level. Access to this service remains subject to the service network policy, if present. If a policy is not present, all traffic from VPCs associated to the service network is allowed.<br>    `AWS_IAM` - Applies an AWS IAM resource policy on the service giving service owners the ability to enforce authentication and write fine grained permissions. This policy is evaluated in addition to any policy present at the service network. | `string` | `"NONE"` | no |
| <a name="input_custom_domain"></a> [custom\_domain](#input\_custom\_domain) | (Optional) The configuration for a custom domain name to use in addition to the domain name that is generated by VPC Lattice. For HTTPS requests, you must also specify an SSL/TLS certificate that matches the custom domain name. If you specify a custom domain name, you must configure DNS routing after your service is created. This is to map DNS queries for the custom domain name to the VPC Lattice endpoint. If youâ€™re using Route 53 as your DNS service, you can configure a CNAME record within the hosted zone that you own. `custom_domain` as defined below.<br>    (Required) `name` - The name of the custom domain. The custom domain name will be used in addition to the domain name that VPC Lattice generates for the service. You can't change the custom domain name after the service is created. For a custom domain name change, you would need to create a new service.<br>    (Optional) `tls_certificate` - The ARN (Amazon Resource Name) of the SSL/TLS certificate. The certificate will be required to process HTTPS requests for the custom domain name. | <pre>object({<br>    name            = string<br>    tls_certificate = optional(string)<br>  })</pre> | `null` | no |
| <a name="input_description"></a> [description](#input\_description) | (Optional) The description of the service. This creates a tag with a key of `Description` and a value that you specify. | `string` | `"Managed by Terraform."` | no |
| <a name="input_listeners"></a> [listeners](#input\_listeners) | (Optional) The configuration to add one or more listeners for the service. Set up listeners and rules to define how network traffic is routed within the service. A listener is a process that checks for connection requests, using the protocol and port that you configure. Each listener has a default action, and you can optionally define rules to enable content-based routing to the target groups that make up your service. Each block of `listeners` as defined below.<br>    (Required) `name` - The name of the service listener. The name must be unique within the service. The valid characters are a-z, 0-9, and hyphens (-). You can't use a hyphen as the first or last character, or immediately after another hyphen.<br>    (Optional) `port` - The number of port on which the listener of the service is listening. Valid values are from `1` to `65535`. If `port` is not specified and `protocol` is `HTTP`, the value will default to `80`. If `port` is not specified and `protocol` is `HTTPS`, the value will default to `443`.<br>    (Required) `protocol` - The protocol for the service listener. Valid values are `HTTP` and `HTTPS`.<br>    (Required) `default_action_type` - The type of default routing action. Default action apply to traffic that does not meet the conditions of rules on your listener. Rules can be configured after the listener is created. Valid values are `FORWARD`, `FIXED_RESPONSE`.<br>    (Optional) `default_action_parameters` - The configuration for the parameters of the default routing action. `default_action_parameters` block as defined below.<br>      (Optional) `status_code` - Custom HTTP status code to drop client requests and return a custom HTTP response. Valid values are `404`. Only supported if `default_action_type` is `FIXED_RESPONSE`.<br>      (Optional) `destinations` - A list of one or more target groups to route traffic. Only supported if `default_action_type` is `FORWARD`. Each item of `destinations` block as defined below.<br>        (Required) `target_group` - The ID or ARN of the target group to which to route traffic.<br>        (Optional) `weight` - The weight to use routing traffic to `target_group`. how requests are distributed to the target group. Only required if you specify multiple target groups for a forward action. For example, if you specify two target groups, one with a weight of 10 and the other with a weight of 20, the target group with a weight of 20 receives twice as many requests as the other target group. Valid value is `0` to `999`. Defaults to `100`.<br>    (Optional) `rules` - A list of rules to enable content-based routing to the target groups that make up the service. Each rule consists of a priority, one or more actions, and one or more conditions. Each block of `rules` block as defined below.<br>      (Required) `priority` - The priority assigned to the rule. Each rule for a specific listener must have a unique priority. The lower the priority number the higher the priority.<br>      (Optional) `name` - A rule name can describe the purpose of the rule or the type of traffic it is intended to handle. Rule names can't be changed after creation. Defaults to `$(service)-$(priority)`.<br>      (Required) `conditions` - The rule conditions. `conditions` block as defined below.<br>        (Optional) `method` - The condition of HTTP request method. Valid values are `GET`, `HEAD`, `POST`, `PUT`, `DELETE`, `CONNECT`, `OPTIONS`, `TRACE`, `PATCH`.<br>        (Required) `path` - The condition of HTTP request path. `path` block as defined below.<br>          (Required) `value` - The path pattern. The pattern must start with `/`.<br>          (Optional) `operator` - The operator that you want to use to determine whether an HTTP request path matches the conditions. Valid values are `EXACT`, `PREFIX`. Defaults to `PREFIX`.<br>          (Optional) `case_sensitive` - Whether to match the `value` condition using a case-sensitive match. Defaults to `false`.<br>        (Optional) `headers` - The condition of HTTP request headers. Each block of `headers` as defined below.<br>          (Required) `name` - The name of the HTTP header field.<br>          (Required) `value` - The value of the HTTP header field.<br>          (Optional) `operator` - The operator that you want to use to determine whether an HTTP header matches the conditions. Valid values are `EXACT`, `PREFIX`, `CONTAINS`. Defaults to `EXACT`.<br>          (Optional) `case_sensitive` - Whether to match the `value` condition using a case-sensitive match. Defaults to `false`.<br>      (Required) `action_type` - The action type for the rule of the service. Valid values are `FORWARD`, `FIXED_RESPONSE`.<br>      (Optional) `action_parameters` - The configuration for the parameters of the routing action. `action_parameters` block as defined below.<br>        (Optional) `status_code` - Custom HTTP status code to drop client requests and return a custom HTTP response. Valid values are `404`. Only supported if `action_type` is `FIXED_RESPONSE`.<br>        (Optional) `destinations` - A list of one or more target groups to route traffic. Only supported if `action_type` is `FORWARD`. Each item of `destinations` block as defined below.<br>          (Required) `target_group` - The ID or ARN of the target group to which to route traffic.<br>          (Optional) `weight` - The weight to use routing traffic to `target_group`. how requests are distributed to the target group. Only required if you specify multiple target groups for a forward action. For example, if you specify two target groups, one with a weight of 10 and the other with a weight of 20, the target group with a weight of 20 receives twice as many requests as the other target group. Valid value is `0` to `999`. Defaults to `100`.<br>    (Optional) `tags` - A map of tags to add to the service listeners. | <pre>list(object({<br>    name     = string<br>    port     = optional(number)<br>    protocol = string<br><br>    default_action_type = string<br>    default_action_parameters = optional(object({<br>      status_code = optional(number, 404)<br>      destinations = optional(list(object({<br>        target_group = string<br>        weight       = optional(number, 100)<br>      })), [])<br>    }), {})<br><br>    rules = optional(list(object({<br>      priority = number<br>      name     = optional(string)<br><br>      conditions = object({<br>        method = optional(string)<br>        path = object({<br>          value          = string<br>          operator       = optional(string, "PREFIX")<br>          case_sensitive = optional(bool, false)<br>        })<br>        headers = optional(list(object({<br>          name           = string<br>          value          = string<br>          operator       = optional(string, "EXACT")<br>          case_sensitive = optional(bool, false)<br>        })), [])<br>      })<br><br>      action_type = string<br>      action_parameters = optional(object({<br>        status_code = optional(number, 404)<br>        destinations = optional(list(object({<br>          target_group = string<br>          weight       = optional(number, 100)<br>        })), [])<br>      }), {})<br>    })), [])<br><br>    tags = optional(map(string), {})<br>  }))</pre> | `[]` | no |
| <a name="input_logging_to_cloudwatch"></a> [logging\_to\_cloudwatch](#input\_logging\_to\_cloudwatch) | (Optional) The configuration to enable access logs to be sent to Amazon CloudWatch Log Group. The service owner can use the access logs to audit the services in the network. The service owner will only see access logs from clients and services that are associated with their service. Access log entries represent traffic originated from VPCs associated with that network. `logging_to_cloudwatch` as defined below.<br>    (Optional) `enabled` - Whether to enable access logs to be sent to Amazon CloudWatch Log Group.<br>    (Optional) `log_group` - The ARN (Amazon Resource Name) of the CloudWatch Log Group. | <pre>object({<br>    enabled   = optional(bool, false)<br>    log_group = optional(string, "")<br>  })</pre> | `{}` | no |
| <a name="input_logging_to_kinesis_data_firehose"></a> [logging\_to\_kinesis\_data\_firehose](#input\_logging\_to\_kinesis\_data\_firehose) | (Optional) The configuration to enable access logs to be sent to Amazon Kinesis Data Firehose. The service owner can use the access logs to audit the services in the network. The service owner will only see access logs from clients and services that are associated with their service. Access log entries represent traffic originated from VPCs associated with that network. `logging_to_kinesis_data_firehose` as defined below.<br>    (Optional) `enabled` - Whether to enable access logs to be sent to Amazon Kinesis Data<br>  Firehose.<br>    (Optional) `delivery_stream` - The ARN (Amazon Resource Name) of the Kinesis Data Firehose<br>  delivery stream. | <pre>object({<br>    enabled         = optional(bool, false)<br>    delivery_stream = optional(string, "")<br>  })</pre> | `{}` | no |
| <a name="input_logging_to_s3"></a> [logging\_to\_s3](#input\_logging\_to\_s3) | (Optional) The configuration to enable access logs to be sent to Amazon S3 Bucket. The service owner can use the access logs to audit the services in the network. The service owner will only see access logs from clients and services that are associated with their service. Access log entries represent traffic originated from VPCs associated with that network. `logging_to_s3` as defined below.<br>    (Optional) `enabled` - Whether to enable access logs to be sent to Amazon S3 Bucket.<br>    (Optional) `bucket` - The ARN (Amazon Resource Name) of the S3 Bucket. | <pre>object({<br>    enabled = optional(bool, false)<br>    bucket  = optional(string, "")<br>  })</pre> | `{}` | no |
| <a name="input_module_tags_enabled"></a> [module\_tags\_enabled](#input\_module\_tags\_enabled) | (Optional) Whether to create AWS Resource Tags for the module informations. | `bool` | `true` | no |
| <a name="input_policy"></a> [policy](#input\_policy) | (Optional) A resource-based permission policy for the service. The policy must contain the same actions and condition statements as the Amazon Web Services Resource Access Manager permission for sharing services and service networks. | `string` | `null` | no |
| <a name="input_resource_group_description"></a> [resource\_group\_description](#input\_resource\_group\_description) | (Optional) The description of Resource Group. | `string` | `"Managed by Terraform."` | no |
| <a name="input_resource_group_enabled"></a> [resource\_group\_enabled](#input\_resource\_group\_enabled) | (Optional) Whether to create Resource Group to find and group AWS resources which are created by this module. | `bool` | `true` | no |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | (Optional) The name of Resource Group. A Resource Group name can have a maximum of 127 characters, including letters, numbers, hyphens, dots, and underscores. The name cannot start with `AWS` or `aws`. | `string` | `""` | no |
| <a name="input_service_network_associations"></a> [service\_network\_associations](#input\_service\_network\_associations) | (Optional) The configuration for the service network associations with the service. To facilitate network client access to your service, you will need to associate your service to the relevant service networks. Only service networks created in the same account, or that have been shared with you (by way of Resource Access Manager), are available for you to create associations with. Each block of `service_network_associations` as defined below.<br>    (Required) `name` - The name of the service association.<br>    (Required) `service_network` - The ID or ARN (Amazon Resource Name) of the service network.<br>    (Optional) `tags` - A map of tags to add to the service association. | <pre>list(object({<br>    name            = string<br>    service_network = string<br>    tags            = optional(map(string), {})<br>  }))</pre> | `[]` | no |
| <a name="input_shares"></a> [shares](#input\_shares) | (Optional) A list of resource shares via RAM (Resource Access Manager). | <pre>list(object({<br>    name = optional(string)<br><br>    permissions = optional(set(string), ["AWSRAMPermissionVpcLatticeServiceReadWrite"])<br><br>    external_principals_allowed = optional(bool, false)<br>    principals                  = optional(set(string), [])<br><br>    tags = optional(map(string), {})<br>  }))</pre> | `[]` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | (Optional) A map of tags to add to all resources. | `map(string)` | `{}` | no |
| <a name="input_timeouts"></a> [timeouts](#input\_timeouts) | (Optional) How long to wait for the service to be created/deleted. | <pre>object({<br>    create = optional(string, "5m")<br>    delete = optional(string, "5m")<br>  })</pre> | `{}` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_arn"></a> [arn](#output\_arn) | The ARN of the service. |
| <a name="output_auth_type"></a> [auth\_type](#output\_auth\_type) | The type of authentication and authorization that manages client access to the service. |
| <a name="output_custom_domain"></a> [custom\_domain](#output\_custom\_domain) | The configuration for a custom domain name to use in addition to the domain name that is generated by VPC Lattice. |
| <a name="output_description"></a> [description](#output\_description) | The description of the service. |
| <a name="output_domain"></a> [domain](#output\_domain) | The DNS name of the service. |
| <a name="output_id"></a> [id](#output\_id) | The ID of the service. |
| <a name="output_listeners"></a> [listeners](#output\_listeners) | The configuration for listeners of the service.<br>    `id` - The ID of the service listener.<br>    `arn` - The ARN of the service listener.<br>    `name` - The name of the service listener.<br>    `port` - The number of port on which the listener of the service is listening.<br>    `protocol` - The protocol for the service listener.<br>    `default_action` - The configuration for default routing action of the service listener.<br>    `rules` - The list of rules to enable content-based routing to the target groups that make up the service.<br>    `created_at` - Date and time that the listener was created, specified in ISO-8601 format.<br>    `updated_at` - Date and time that the listener was last updated, specified in ISO-8601 format. |
| <a name="output_logging"></a> [logging](#output\_logging) | The configuration for access logs of the service.<br>    `cloudwatch` - The configuration for access logs to be sent to Amazon CloudWatch Log Group.<br>    `kinesis_data_firehose` - The configuration for access logs to be sent to Amazon Kinesis Data Firehose Delivery Stream.<br>    `s3` - The configuration for access logs to be sent to Amazon S3 BUcket. |
| <a name="output_name"></a> [name](#output\_name) | The name of the service. |
| <a name="output_service_network_associations"></a> [service\_network\_associations](#output\_service\_network\_associations) | The configuration for the service network associations with the service.<br>    `id` - The ID of the association.<br>    `arn` - The ARN of the Association.<br>    `status` - The operations status. Valid Values are `CREATE_IN_PROGRESS`, `ACTIVE`, `DELETE_IN_PROGRESS`, `CREATE_FAILED`, `DELETE_FAILED`.<br>    `created_by` - The principal that created the association.<br><br>    `service_network` - The ARN (Amazon Resource Name) of the service network. |
| <a name="output_sharing"></a> [sharing](#output\_sharing) | The configuration for sharing of the Lattice service.<br>    `status` - An indication of whether the Lattice service is shared with other AWS accounts, or was shared with the current account by another AWS account. Sharing is configured through AWS Resource Access Manager (AWS RAM). Values are `NOT_SHARED`, `SHARED_BY_ME` or `SHARED_WITH_ME`.<br>    `shares` - The list of resource shares via RAM (Resource Access Manager). |
| <a name="output_status"></a> [status](#output\_status) | The status of the service. |
| <a name="output_zone_id"></a> [zone\_id](#output\_zone\_id) | The canonical hosted zone ID of the service to be used in a Route 53 CNAME record. |
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
